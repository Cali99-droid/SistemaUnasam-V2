obtenerGrupos(),botonGrupo();let grupos=[],filtradas=[];const busqueda=document.querySelector("#nom");busqueda.addEventListener("keyup",buscarGrupo);const crearGrup=document.querySelector("#boton-agregar-grupo");function buscarGrupo(e){const t=e.target.value;filtradas=findMatches(t,grupos),mostrarGrupos()}function findMatches(e,t){return t.filter(t=>{const o=new RegExp(e,"gi");return t.nombre.match(o)||t.tipo.nombre.match(o)})}async function obtenerGrupos(){try{const e="http://appunasam.devor/api/grupos",t=await fetch(e),o=await t.json();grupos=o.grupos,mostrarGrupos(!0)}catch(e){console.log(e)}}function mostrarGrupos(e=!1){e&&grupos.reverse(),limpiarGrupos();const t=filtradas.length?filtradas:grupos;if(0===t.length)return void console.log("no hay grupos");const o=document.querySelector("#contenedor-grupos");t.forEach(e=>{const t=document.createElement("DIV");t.dataset.grupoId=e.id,t.classList.add("grupo");const n=document.createElement("DIV");n.classList.add("divIc"),n.classList.add("an-right"),n.setAttribute("title","Eliminar");const r=document.createElement("I");r.classList.add("far"),r.classList.add("fa-trash-alt"),r.classList.add("btn-eliminar"),n.appendChild(r),n.dataset.idGruo=e.id,n.onclick=function(){confirmarEliminarGrupo({...e})},t.appendChild(n);const a=document.createElement("A");a.setAttribute("href","/grupo?id="+e.id);const i=document.createElement("IMG");i.setAttribute("src","/imagenes/"+e.imagen),i.classList.add("grupo-imagen");const c=document.createElement("DIV");c.classList.add("container");const s=document.createElement("H4");s.classList.add("no-margin"),s.textContent=e.nombre;const u=document.createElement("P");u.textContent=e.tipo.nombre;const l=document.createElement("P");l.textContent="Integrantes:  "+e.cantidad_integrantes,c.appendChild(s),c.appendChild(u),c.appendChild(l),a.appendChild(i),a.appendChild(c),t.appendChild(a),o.appendChild(t)})}function confirmarEliminarGrupo(e){Swal.fire({title:"Eliminar Organización?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&eliminarGrupo(e)})}async function eliminarGrupo(e){const{id:t}=e,o=new FormData;o.append("id",t);try{const e="http://appunasam.devor/grupo/eliminar",t=await fetch(e,{method:"POST",body:o}),n=await t.json();n.tipo?(Swal.fire("Eliminado!",n.mensaje,"success"),obtenerGrupos(),mostrarGrupos()):Swal.fire("Mensaje!",n.mensaje,"info")}catch(e){Swal.fire({icon:"error",title:"Error...",text:"Hubo un error al eliminar!"})}}function limpiarGrupos(){const e=document.querySelector("#contenedor-grupos");for(;e.firstChild;)e.removeChild(e.firstChild)}function mostrarForm(e={}){const t=document.getElementById("modal-grupo"),o=document.getElementsByClassName("close-grupo")[0];t.style.display="block",o.onclick=function(){t.style.display="none"};document.querySelector("#crearGrupo").classList.add("crearGrupo"),t.addEventListener("click",(function(t){if(t.target.classList.contains("crearGrupo")){t.target.classList.remove("crearGrupo");const o=document.querySelector("#nombre-grupo").value.trim(),n=document.querySelector("#fecha_creacion").value,r=document.querySelector("#resolucion").value,a=document.querySelector("#tipo_grupo_id").value,i=document.querySelector("#imagen");e.nombre=o,e.fecha_creacion=n,e.resolucion=r,e.tipo_grupo_id=a,e.imagen=i.files[0],crearGrupo(e)}}))}async function crearGrupo(e){const t=new FormData;t.append("nombre",e.nombre),t.append("fecha_creacion",e.fecha_creacion),t.append("resolucion_creacion",e.resolucion),t.append("tipo_grupo_id",e.tipo_grupo_id),t.append("imagen",e.imagen);try{const o="http://appunasam.devor/grupos",n=await fetch(o,{method:"POST",body:t}),r=await n.json();if(Swal.fire("ÉXITO",r.mensaje,"success"),"exito"==r.tipo){const t=document.querySelector("#modal-grupo");setTimeout(()=>{t.style.display="none"},1e3);String(r.tipo_grupo.nombre);const o={id:String(r.id),nombre:e.nombre,tipo:{nombre:String(r.tipo_grupo.nombre)},cantidad_integrantes:String(r.cantidad_integrantes),imagen:String(r.imagen)};grupos.unshift(o),mostrarGrupos()}}catch(e){console.log(e)}}function modalS(e,t,o){e=document.getElementById(e);var n=document.getElementsByClassName(o)[0];e.style.display="block",n.onclick=function(){e.style.display="none"},window.onclick=function(t){t.target==e&&(e.style.display="none")}}function botonGrupo(){const e=document.querySelector("#crearTipo");e&&(e.onclick=crearTipof)}async function crearTipof(){const e=document.querySelector("#nombre_tipo"),t=document.querySelector("#idTipoGrupo");if(0==e.value.trim().length)return e.value="",e.focus(),void Swal.fire({icon:"warning",title:"ADVEVERTENCIA !",text:"El nombre es obligatorio"});const o=new FormData;o.append("nombre",e.value),o.append("id",t.value);try{const n="http://appunasam.devor/api/tipos",r=await fetch(n,{method:"POST",body:o});await r.json()?Swal.fire({icon:"success",title:"Tipo Creado",text:"El tipo fue registrado correctamente!"}).then(()=>{e.value="",t.value="",cargarTipos()}):Swal.fire({icon:"error",title:"Error...",text:"Ya existe el nombre del el tipo!"})}catch(e){Swal.fire({icon:"error",title:"Error...",text:"Hubo un error al guardar el tipo!"})}}async function cargarTipos(){try{const e="http://appunasam.devor/api/tipos",t=await fetch(e);mostrarComboTipos(await t.json())}catch(e){console.log(e)}}function mostrarComboTipos(e){const t=document.querySelector("#tipo_grupo_id"),o=e[e.length-1],{id:n,nombre:r}=o,a=document.createElement("OPTION");a.value=n,a.textContent=r,t.appendChild(a)}crearGrup.addEventListener("click",mostrarForm);