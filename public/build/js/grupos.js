document.addEventListener("DOMContentLoaded",(function(){obtenerGrupos()}));let grupos=[],filtradas=[];const busqueda=document.querySelector("#nom");busqueda.addEventListener("keyup",buscarGrupo);const crearGrup=document.querySelector("#boton-agregar-grupo");function buscarGrupo(e){const t=e.target.value;filtradas=findMatches(t,grupos),mostrarGrupos()}function findMatches(e,t){return t.filter(t=>{const n=new RegExp(e,"gi");return t.nombre.match(n)||t.tipo.nombre.match(n)})}async function obtenerGrupos(){try{const e="http://appunasam.devor/api/grupos",t=await fetch(e),n=await t.json();grupos=n.grupos,mostrarGrupos(!0)}catch(e){console.log(e)}}function mostrarGrupos(e=!1){e&&grupos.reverse(),limpiarGrupos();const t=filtradas.length?filtradas:grupos;if(0===t.length)return void console.log("no hay grupos");const n=document.querySelector("#contenedor-grupos");t.forEach(e=>{const t=document.createElement("DIV");t.dataset.grupoId=e.id,t.classList.add("grupo");const o=document.createElement("DIV");o.classList.add("divIc"),o.classList.add("an-right"),o.setAttribute("title","Eliminar");const r=document.createElement("I");r.classList.add("far"),r.classList.add("fa-trash-alt"),r.classList.add("btn-eliminar"),o.appendChild(r),o.dataset.idGruo=e.id,o.onclick=function(){confirmarEliminarGrupo({...e})},t.appendChild(o);const a=document.createElement("A");a.setAttribute("href","/grupo?id="+e.id);const i=document.createElement("IMG");i.setAttribute("src","/imagenes/"+e.imagen),i.classList.add("grupo-imagen");const c=document.createElement("DIV");c.classList.add("container");const s=document.createElement("H4");s.classList.add("no-margin"),s.textContent=e.nombre;const u=document.createElement("P");u.textContent=e.tipo.nombre;const d=document.createElement("P");d.textContent="Integrantes:  "+e.cantidad_integrantes,c.appendChild(s),c.appendChild(u),c.appendChild(d),a.appendChild(i),a.appendChild(c),t.appendChild(a),n.appendChild(t)})}function confirmarEliminarGrupo(e){Swal.fire({title:"Eliminar Organización?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&eliminarGrupo(e)})}async function eliminarGrupo(e){const{id:t}=e,n=new FormData;n.append("id",t);try{const e="http://appunasam.devor/grupo/eliminar",t=await fetch(e,{method:"POST",body:n}),o=await t.json();o.tipo?(Swal.fire("Eliminado!",o.mensaje,"success"),obtenerGrupos(),mostrarGrupos()):Swal.fire("Mensaje!",o.mensaje,"info")}catch(e){Swal.fire({icon:"error",title:"Error...",text:"Hubo un error al eliminar!"})}}function limpiarGrupos(){const e=document.querySelector("#contenedor-grupos");for(;e.firstChild;)e.removeChild(e.firstChild)}function mostrarForm(e={}){const t=document.getElementById("modal-grupo"),n=document.getElementsByClassName("close-grupo")[0];t.style.display="block",n.onclick=function(){t.style.display="none"};document.querySelector("#crearGrupo").classList.add("crearGrupo"),t.addEventListener("click",(function(t){if(t.target.classList.contains("crearGrupo")){t.target.classList.remove("crearGrupo");const n=document.querySelector("#nombre-grupo").value.trim(),o=document.querySelector("#fecha_creacion").value,r=document.querySelector("#resolucion").value,a=document.querySelector("#tipo_grupo_id").value,i=document.querySelector("#imagen");e.nombre=n,e.fecha_creacion=o,e.resolucion=r,e.tipo_grupo_id=a,e.imagen=i.files[0],crearGrupo(e)}}))}async function crearGrupo(e){const t=new FormData;t.append("nombre",e.nombre),t.append("fecha_creacion",e.fecha_creacion),t.append("resolucion_creacion",e.resolucion),t.append("tipo_grupo_id",e.tipo_grupo_id),t.append("imagen",e.imagen);try{const n="http://appunasam.devor/grupos",o=await fetch(n,{method:"POST",body:t}),r=await o.json();if(Swal.fire("ÉXITO",r.mensaje,"success"),"exito"==r.tipo){const t=document.querySelector("#modal-grupo");setTimeout(()=>{t.style.display="none"},1e3);String(r.tipo_grupo.nombre);const n={id:String(r.id),nombre:e.nombre,tipo:{nombre:String(r.tipo_grupo.nombre)},cantidad_integrantes:String(r.cantidad_integrantes),imagen:String(r.imagen)};grupos.unshift(n),mostrarGrupos()}}catch(e){console.log(e)}}crearGrup.addEventListener("click",mostrarForm);