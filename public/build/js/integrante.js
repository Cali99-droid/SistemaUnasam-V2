obtenerDatos();let invitaciones=[],participaciones=[],derechos=[],beneficios=[],filtradas=[];async function obtenerDatos(){try{const e=obtenerIntegrante(),t=`http://localhost:3000/integrante/getParticipaciones?id=${e}&idGrupo=${obtenerGrupo()}`,n=await fetch(t),i=await n.json();invitaciones=i.invitaciones,participaciones=i.participaciones,derechos=i.derechos,beneficios=i.beneficios,mostrarParticipaciones(),mostrarInvitaciones()}catch(e){console.log(e)}}function mostrarParticipaciones(){limpiar("#cuerpo-part");const e=document.getElementById("cuerpo-part");participaciones.forEach(t=>{const n=document.createElement("TR"),i=document.createElement("TD");i.textContent=t.nombreEvento;const a=document.createElement("TD");a.textContent=t.tipo;const o=document.createElement("TD"),s=document.createElement("BUTTON");s.classList.add("boton-asignar"),s.dataset.idParticipacion=t.id,s.ondblclick=function(){confirmarQuitarPart({...t})};const c=document.createElement("I");c.classList.add("fas"),c.classList.add("fa-minus-circle");const r=document.createElement("SPAN");r.textContent=" Quitar",s.appendChild(c),s.appendChild(r),o.appendChild(s),n.appendChild(i),n.appendChild(a),n.appendChild(o),e.appendChild(n)})}function confirmarQuitarPart(e){Swal.fire({title:"Eliminar participación?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{t.isConfirmed&&eliminarPart(e)})}async function eliminarPart(e){const{id:t}=e,n=new FormData;n.append("id",t);try{const t="http://localhost:3000/integrante/deleteAsistencia",i=await fetch(t,{method:"POST",body:n}),a=await i.json();a&&(Swal.fire("Eliminado!",a.mensaje,"success"),participaciones=participaciones.filter(t=>t.id!==e.id),console.log(participaciones),obtenerDatos(),console.log(participaciones),mostrarParticipaciones(),mostrarInvitaciones())}catch(e){Swal.fire({icon:"error",title:"Error...",text:"Hubo un error al eliminar!"})}}function limpiar(e){const t=document.querySelector(e);for(;t.firstChild;)t.removeChild(t.firstChild)}function obtenerIntegrante(){return document.querySelector("#idAlumnoGrupo").value}function obtenerGrupo(){const e=new URLSearchParams(window.location.search);return grupo=Object.fromEntries(e.entries()),grupo.id}function mostrarInvitaciones(e=!0){limpiar("#cuerpo-inv");const t=document.getElementById("cuerpo-inv");invitaciones.forEach(e=>{const n=document.createElement("TR"),i=document.createElement("TD");i.textContent=e.evento;const a=document.createElement("TD");a.textContent=e.fecha_hora;const o=document.createElement("TD"),s=document.createElement("SPAN");s.classList.add("label"),"CUMPLIDA"===e.est&&s.classList.add("label-ok"),s.textContent=e.est,o.appendChild(s);const c=document.createElement("TD");c.textContent=e.observacion;const r=document.createElement("TD"),l=document.createElement("BUTTON");l.classList.add("boton-asignar"),l.dataset.idInv=e.id,l.onclick=function(){asignarAsistencia({...e})};const d=document.createElement("I");d.classList.add("fas"),d.classList.add("fa-plus-circle");const p=document.createElement("SPAN");p.textContent=" Asignar Asistencia",l.appendChild(d),l.appendChild(p),r.appendChild(l),n.appendChild(i),n.appendChild(a),n.appendChild(o),n.appendChild(c),n.appendChild(r),t.appendChild(n)})}function asignarAsistencia(e){document.querySelector("#btn-as").classList.add("asignar-asis");const t=document.getElementById("modal-asistencia");mostrarModal(t,document.getElementsByClassName("close-asis")[0]),t.addEventListener("click",(function(t){t.target.classList.contains("asignar-asis")&&(t.target.classList.remove("asignar-asis"),crearAsistencia(e))}))}async function crearAsistencia(e){const t=document.querySelector("#tipo-part").value;datos=new FormData,idAl=obtenerIntegrante(),datos.append("invitacion_id",e.id),datos.append("alumno_x_grupo_id",idAl),datos.append("tipo",t);try{const n="http://localhost:3000/integrante/setAsistencia",i=await fetch(n,{method:"POST",body:datos}),a=await i.json();if(console.log(a),a.tipo){const n=document.querySelector("#modal-asistencia");setTimeout(()=>{n.style.display="none"},2e3),Swal.fire("ÉXITO!",a.mensaje,"success");const i={id:String(a.id),nombreEvento:e.evento,tipo:t};console.log(i),participaciones=[...participaciones,i],obtenerDatos(),mostrarParticipaciones(),mostrarInvitaciones()}else Swal.fire("MENSAJE!",a.mensaje,"info")}catch(e){Swal.fire({icon:"error",title:"Error...",text:"Hubo un error al guardar la asistencia!"})}}function mostrarModal(e,t){e.style.display="block",t.onclick=function(){e.style.display="none"}}var slideIndex=1;function plusSlides(e){showSlides(slideIndex+=e)}function currentSlide(e){showSlides(slideIndex=e)}function showSlides(e){var t,n=document.getElementsByClassName("mySlides"),i=document.getElementsByClassName("btn-slide");for(e>n.length&&(slideIndex=1),e<1&&(slideIndex=n.length),t=0;t<n.length;t++)n[t].style.display="none";for(t=0;t<i.length;t++)i[t].className=i[t].className.replace(" active","");n[slideIndex-1].style.display="block",i[slideIndex-1].className+=" active"}showSlides(slideIndex);